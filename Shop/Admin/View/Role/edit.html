<extend name="Common:common" />
<!-- 标题 -->
<block name="title">
    <title>管理中心 - 编辑角色</title>
</block>
<!-- 具体操作 -->
<block name="action">
    <span class="action-span"><a href="{:U('lst')}">返回</a></span>
    <span id="search_id"> - 编辑角色</span>
</block>
<block name="asset">
    <script type="text/javascript">
        $(function(){
            // JS智能选择
            // 为所有的选择框绑定点击事件
            $(":checkbox").click(function(){
                var _this=this;
                // 先取出当前权限的auth_level值是多少
                var cur_level = $(this).attr("auth_level");
                var tmplevel = cur_level; // 给一个临时的变量后面要进行减操作
                // 先取出这个复选框所有前面的复选框
                var allprev = $(this).prevAll(":checkbox");
                // 循环每一个前面的复选框判断是不是上级的
                $(allprev).each(function(k,v){
                    // 判断是不是上级的权限
                    if($(v).attr("auth_level") < cur_level){
                        $(v).get(0).checked=$(_this).get(0).checked;
                        tmplevel--; // 再向上提一级
                    }
                });
                // 所有子权限也选中
                // 先取出这个复选框所有前面的复选框
                var allnext = $(this).nextAll(":checkbox");
                // 循环每一个前面的复选框判断是不是上级的
                $(allnext).each(function(k,v){
                    // 判断是不是上级的权限
                    if($(v).attr("auth_level") > cur_level){
                        $(v).get(0).checked=$(_this).get(0).checked;
                        tmplevel++;
                    }else{return false;}
                    // 遇到一个平级的权限就停止循环后面的不用再哦安短了


                    
                });
            });
        });
    </script>
</block>
<!-- 列表 -->
<block name="main">
    <div class="main-div">
        <form method="POST" style="margin:5px;" action="__SELF__">
            <input type="hidden" value="{$data['id']}" name="id" />
            <p>角色名称：<input type="text" name="role_name" value="{$data['role_name']}" /></p>
            <p>为该角色修改分配的权限：
                <div class="alert alert-info">
                    <volist name="data1" id="obj">
                        {:str_repeat('-',$obj['auth_level']*8)}
                        <input type="checkbox" name="auth_id[]" style="margin:5px;" value="{$obj.id}" level="auth_level" 
                        <?php if(strpos($data['auth_id'],$obj['id'])!==false)
                        echo "checked";
                         ?>
                         >{$obj.auth_name}
                    </volist>
                </div>
            </p>
            <input type="submit" class="btn btn-primarty" value="确定" />
        </form>
    </div>
</block>